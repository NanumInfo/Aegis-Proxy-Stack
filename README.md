# ğŸ›¡ï¸ Aegis-Proxy-Stack

NGINX Proxy Manager(NPM)ì˜ ì‚¬ìš© ë° ê´€ë¦¬ í¸ì˜ì„±ì— ë”í•˜ì—¬ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ ì†”ë£¨ì…˜(WAF, IPS, Visualizer)ì„ ê²°í•©í•œ ì˜¬ì¸ì›(All-in-One) ë³´ì•ˆ í†µí•© íŒ¨í‚¤ì§€ë¡œ ë§Œë“¤ì–´ ëˆ„êµ¬ë‚˜ íš¨ìœ¨ì ì¸ ë°©ì–´ì²´ê³„ë¥¼ ì†ì‰½ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ ì‹œì‘í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

'Aegis(ì´ì§€ìŠ¤)'ëŠ” ê·¸ë¦¬ìŠ¤ ì‹ í™”ì—ì„œ ì œìš°ìŠ¤ì™€ ì•„í…Œë‚˜ê°€ ì‚¬ìš©í•œ ë°©íŒ¨ë¥¼ ì˜ë¯¸í•˜ë©°, ê°•ë ¥í•œ ë³´í˜¸ì™€ ë°©ì–´ë¥¼ ìƒì§•í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ë³´ì•ˆ ê³„ì¸µ(WAF, IPS, Visualizer)ì´ ê²¹ê²¹ì´ ìŒ“ì—¬(Stack) ì™„ë²½í•œ ë°©ì–´ë¥¼ ì œê³µí•œë‹¤ëŠ” ì˜ë¯¸ë¥¼ ë‹´ì•˜ìŠµë‹ˆë‹¤.

ë¦¬ëˆ…ìŠ¤ í™˜ê²½ì˜ Docker ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ì¦‰ì‹œ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë©°, ê¸°ê³„ í•™ìŠµ ê¸°ë°˜ì˜ ì œë¡œë°ì´ ê³µê²© ì°¨ë‹¨, ì§‘ë‹¨ì§€ì„± ê¸°ë°˜ì˜ IP í‰íŒ ë¶„ì„, ê·¸ë¦¬ê³  ì‹¤ì‹œê°„ ì§€ë¦¬ì  ì‹œê°í™” ëª¨ë‹ˆí„°ë§ì„ í•˜ë‚˜ì˜ í†µí•©ëœ í™˜ê²½ì—ì„œ ì œê³µí•˜ë©°, ë‚˜ì•„ê°€ **Aegis í†µí•© ê´€ë¦¬ UI**ê¹Œì§€ ê°œë°œí•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

## ğŸŒŸ Key Features

* **Core Proxy:** [NGINX Proxy Manager](https://nginxproxymanager.com) ê¸°ë°˜ì˜ ì§ê´€ì ì¸ ë„ë©”ì¸ ë° TLS Certificates ê´€ë¦¬
* **ML-Based WAF:** [open-appsec](https://www.openappsec.io) íƒ‘ì¬ë¡œ OWASP Top 10 ë° ì œë¡œë°ì´ ê³µê²©ì— ëŒ€í•œ ì„ ì œì  ë°©ì–´ (ì„œëª… ì—…ë°ì´íŠ¸ ë¶ˆí•„ìš”)
* **Advanced Machine Learning Model:** [ê³ ê¸‰ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸](https://docs.openappsec.io/getting-started/using-the-advanced-machine-learning-model)ì„ ì ìš©í•œ ë°©ì–´ì²´ê³„ êµ¬ì¶• **(Phase 2 Scheduled)**
* **Crowd-Sourced IPS:** [CrowdSec](https://www.crowdsec.net) í†µí•©ìœ¼ë¡œ ì „ ì„¸ê³„ ìœ„í˜‘ IP ë°ì´í„° ì‹¤ì‹œê°„ ê³µìœ  ë° ì°¨ë‹¨ **(Phase 3 Scheduled)**
* **Real-time Visualization:** [GoAccess](https://goaccess.io)ì™€ [GeoIP2](https://www.maxmind.com) ì—°ë™ìœ¼ë¡œ íŠ¸ë˜í”½ ë° ê³µê²©ì§€ì  ì§€ë„ ê¸°ë°˜ ì‹œê°í™” **(Phase 4 Scheduled)**
* **Aegis Integrated Management UI:** ìƒê¸° ë³´ì•ˆ ì†”ë£¨ì…˜ í†µí•© ê´€ë¦¬ë¥¼ ìœ„í•œ ì›¹ ê¸°ë°˜ ê´€ë¦¬ ì†”ë£¨ì…˜ ê°œë°œ **(Phase 5 Scheduled)**

## ğŸ“œ Architecture (Roadmap)

* **Phase 1:** NGINX Proxy Manager + open-appsec ML-Based WAF Integration (âœ… Current)
* **Phase 2:** Using the Advanced Machine Learning Model
* **Phase 3:** CrowdSec IPS Integration
* **Phase 4:** GoAccess + GeoIP Visualization Setup
* **Phase 5:** Aegis Integrated Management UI
* **Phase 6:** Integration with other Security Solutions
* **Phase 7:** Enhanced Performance and Functionality

---

## ğŸ› ï¸ Technical Specifications (ê¸°ìˆ ì  íŠ¹ì§•)

Aegis-Proxy-Stackì€ ë‹¨ìˆœí•œ í†µí•©ì„ ë„˜ì–´, ìš´ì˜ ì•ˆì •ì„±ê³¼ ë³´ì•ˆ ê·œì œ ì¤€ìˆ˜(Compliance)ë¥¼ ê³ ë ¤í•˜ì—¬ ì •êµí•˜ê²Œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

### 1. ë³´ì•ˆ ê°•í™” ì•„í‚¤í…ì²˜ (Hardened Security)
* **IPv4 Only & IPv6 Leak Prevention:** IPv6ë¥¼ í†µí•œ ìš°íšŒ ê³µê²©ì´ë‚˜ ì •ë³´ ìœ ì¶œì„ ë°©ì§€í•˜ê¸° ìœ„í•´ 3ì¤‘ ì ê¸ˆ ì¥ì¹˜(Docker Ports, App Environment, Kernel Sysctl)ë¥¼ ì ìš©í•˜ì—¬ IPv6 íŠ¸ë˜í”½ì„ ì›ì²œ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.
* **Isolated Network (ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬):** `aegis-network`ë¼ëŠ” ë…ë¦½ëœ ë‚´ë¶€ ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì„ ì œì–´í•©ë‹ˆë‹¤. íŠ¹íˆ ë°ì´í„°ë² ì´ìŠ¤(DB)ëŠ” í˜¸ìŠ¤íŠ¸ í¬íŠ¸ë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê³  ì˜¤ì§ ë‚´ë¶€ë§ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ê²©ë¦¬í–ˆìŠµë‹ˆë‹¤.

### 2. ê·œì œ ì¤€ìˆ˜í˜• ë¡œê·¸ ê´€ë¦¬ (Compliance-Ready Logging)
* **Log-Rotator Sidecar:** í˜¸ìŠ¤íŠ¸ OSì˜ ì„¤ì •ì— ì˜ì¡´í•˜ì§€ ì•Šê³ , Docker ë‚´ë¶€ì˜ ë…ë¦½ì ì¸ `log-rotator` ì‚¬ì´ë“œì¹´ ì»¨í…Œì´ë„ˆê°€ ë¡œê·¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
* **1-Year Retention:** ë³´ì•ˆ ê·œì œ(ISMS-P ë“±)ë¥¼ ê³ ë ¤í•˜ì—¬ ëª¨ë“  ë³´ì•ˆ ë¡œê·¸ëŠ” **365ì¼ê°„ ë³´ê´€**ë˜ë©°, ì¼ ë‹¨ìœ„(Daily)ë¡œ ì••ì¶•(Compress)ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
* **Copytruncate Strategy:** ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ëŠ” ë¡œê·¸ ìˆœí™˜ì„ ìœ„í•´ `copytruncate` ë°©ì‹ì„ ì±„íƒí•˜ì—¬ ë¬´ì¤‘ë‹¨ ìš´ì˜ì„ ë³´ì¥í•©ë‹ˆë‹¤.

### 3. ìµœì í™”ëœ ë°ì´í„°ë² ì´ìŠ¤ (Optimized Database)
* **MariaDB Aria Engine:** NGINX Proxy Managerì— ìµœì í™”ëœ ê²½ëŸ‰í™” ì´ë¯¸ì§€(`jc21/mariadb-aria`)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ìµœì†Œí™”í–ˆìŠµë‹ˆë‹¤.
* **Modular Init System:** `db-init` ë””ë ‰í† ë¦¬ë¥¼ í†µí•´ í–¥í›„ ì¶”ê°€ë  ë³´ì•ˆ ëª¨ë“ˆ(CrowdSec ë“±)ì˜ DB ìŠ¤í‚¤ë§ˆë¥¼ ëª¨ë“ˆì‹ìœ¼ë¡œ ìë™ í™•ì¥í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ê°–ì¶”ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸš€ Installation & Getting Started

### ğŸ“‹ Prerequisites (ì‚¬ì „ ìš”êµ¬ ì‚¬í•­ ë° í™˜ê²½ ì ê²€)

ì„¤ì¹˜ë¥¼ ì§„í–‰í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ì•„ë˜ ì‚¬í•­ë“¤ì„ í™•ì¸í•´ì£¼ì„¸ìš”.

**ë³¸ í”„ë¡œì íŠ¸ëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ `root` ê³„ì •ì´ ì•„ë‹Œ `ì¼ë°˜ ì‚¬ìš©ì` ê³„ì •ìœ¼ë¡œ ì„¤ì¹˜ ë° ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.**

#### 1. Docker ì„¤ì¹˜ ë° ë²„ì „ í™•ì¸ (í•„ìˆ˜)
í„°ë¯¸ë„ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì„¤ì¹˜ëœ ë²„ì „ì´ ì•„ë˜ì˜ ìµœì†Œ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

* Docker version 20.10.x ì´ìƒ
* Docker Compose version v2.0.x ì´ìƒ

> ```bash
> docker --version
> docker compose version
> ```

**ğŸš¨ Dockerê°€ ì—†ê±°ë‚˜ ë²„ì „ì´ ë‚®ì€ ê²½ìš° (í•´ê²° ë°©ë²•)**

ì•„ë˜ì™€ ê°™ì€ ê³µì‹ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ìµœì‹  ë²„ì „ì˜ Dockerì™€ Composeê°€ ìë™ìœ¼ë¡œ ì„¤ì¹˜(ë˜ëŠ” ì—…ë°ì´íŠ¸)ë©ë‹ˆë‹¤.
> ```bash
> curl -fsSL https://get.docker.com | sudo sh
> ```

#### 2. ì‚¬ìš©ì ê¶Œí•œ í™•ì¸ (Docker ê·¸ë£¹ ì„¤ì •)
ì¼ë°˜ ê³„ì •ì—ì„œ `sudo` ì—†ì´ Docker ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´, í•´ë‹¹ ê³„ì •ì´ `docker` ê·¸ë£¹ì— í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

**Step 1. í˜„ì¬ ê¶Œí•œ í™•ì¸**
í„°ë¯¸ë„ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í–ˆì„ ë•Œ, ì—ëŸ¬ ì—†ì´ ì»¨í…Œì´ë„ˆ ëª©ë¡(ë˜ëŠ” ë¹ˆ ëª©ë¡)ì´ ë‚˜ì™€ì•¼ í•©ë‹ˆë‹¤.
> ```bash
> docker ps
> ```
**ğŸš¨ `permission denied` ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ ì•„ë˜ Step 2ë¥¼ ì§„í–‰í•˜ì„¸ìš”.**

**Step 2. Docker ê·¸ë£¹ì— ì‚¬ìš©ì ì¶”ê°€ (í•„ìš”ì‹œ)**
* í˜„ì¬ ì‚¬ìš©ìë¥¼ docker ê·¸ë£¹ì— ì¶”ê°€ ë° ê·¸ë£¹ ë³€ê²½ ì‚¬í•­ ì ìš©ì„ ìœ„í•´ ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰

> ```bash
> sudo usermod -aG docker $USER 
> newgrp docker
> ```

#### 3. í•„ìˆ˜ í¬íŠ¸ í™•ì¸
Aegis-Proxy-Stackì€ ë‹¤ìŒ í¬íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•´ë‹¹ í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.
* **80 (HTTP):** ì›¹ ì„œë¹„ìŠ¤ (Letâ€™s Encrypt Certificates ìë™ ë°œê¸‰)
* **81 (Admin):** NGINX Proxy Manager ê´€ë¦¬ì í˜ì´ì§€
* **443 (HTTPS):** ì›¹ ì„œë¹„ìŠ¤ (TLS)

#### 4. open-appsec í† í° ë°œê¸‰ (Get Agent Token)
WAF ì—”ì§„ì„ í™œì„±í™”í•˜ê¸° ìœ„í•´ ê´€ë¦¬ í¬í„¸ì—ì„œ ì—ì´ì „íŠ¸ í† í°ì„ ë°œê¸‰ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.
> 1. [open-appsec Portal](https://my.openappsec.io)ì— ì ‘ì†í•˜ì—¬ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ì„ ì§„í–‰í•©ë‹ˆë‹¤.
> 2. ëŒ€ì‹œë³´ë“œ ìƒë‹¨ ë©”ë‰´ì—ì„œ **Profiles**ë¥¼ í´ë¦­í•œ í›„, **Add Profile** ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
> 3. **Docker** ìœ í˜•ìœ¼ë¡œ ì„ íƒí•˜ê³ , í”„ë¡œí•„ ì´ë¦„(ì˜ˆ: `aegis-waf`)ì„ ì ì ˆí•˜ê²Œ ì…ë ¥í•©ë‹ˆë‹¤.
> 4. **Sub Type** ìœ í˜•ì€ **NGINX Proxy Manager + open-appsec**ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.
> 5. **Management** ìœ í˜•ì€ **Declarative configuration - using open-appsec configuration file**ë¡œ ì„ íƒí•©ë‹ˆë‹¤.
> 6. í™”ë©´ì— í‘œì‹œë˜ëŠ” **Agent Token** (ì˜ˆ: `cp-xxxxxxxx...`)ì„ ë³µì‚¬í•˜ì—¬ ì•ˆì „í•œ ê³³ì— ê¸°ë¡í•©ë‹ˆë‹¤.
> 7. í˜ì´ì§€ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ **Enforce** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì •ì±…ì„ ì‹œí–‰í•©ë‹ˆë‹¤.
* **Note:** ì´ í† í°ì€ ë‹¤ìŒ ë‹¨ê³„ì¸ `install.sh` ì‹¤í–‰ ì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.

---

### ğŸ› ï¸ Step-by-Step Install Guide


**1. ì‘ì—… í™˜ê²½ êµ¬ì„± (Prepare)**
í”„ë¡œì íŠ¸ì˜ ì²´ê³„ì ì¸ ê´€ë¦¬ì™€ í–¥í›„ í™•ì¥ì„±ì„ ìœ„í•´ `aegis` ì „ìš© ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ì—¬ ì„¤ì¹˜í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
ì•„ë˜ ëª¨ë“  ê³¼ì •ì€ ë°˜ë“œì‹œ `root`ê°€ ì•„ë‹Œ ì¼ë°˜ ì‚¬ìš©ì ê³„ì •ìœ¼ë¡œ ì§„í–‰í•´ ì£¼ì„¸ìš”.

ì‚¬ìš©ì í™ˆë””ë ‰í† ë¦¬ì— 'aegis' í”„ë¡œì íŠ¸ ìµœìƒìœ„ í´ë” ìƒì„± í›„ í•´ë‹¹ í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
> ```bash
> mkdir -p ~/aegis
> cd ~/aegis
> ```

**2. ì €ì¥ì†Œ ë³µì œ (Clone Repository)**
> ```bash
> git clone https://github.com/NanumInfo/aegis-proxy-stack.git
> cd aegis-proxy-stack
> ```

**3. ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (Run Interactive Installer)**
í¬í•¨ëœ `install.sh` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ í•„ìš”í•œ ë³´ì•ˆ í† í°ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ì•„ ìë™ìœ¼ë¡œ ì„¤ì •ì„ ì™„ë£Œí•©ë‹ˆë‹¤.
> ```bash
> chmod +x install.sh
> ./install.sh
> ```
> **Info:** ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” `waf-logs`, `db`, `letsencrypt` ë“± ëŸ°íƒ€ì„ì— í•„ìš”í•œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³  ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.

**4. ì„œë¹„ìŠ¤ ì‹¤í–‰ (Start Services)**
> ```bash
> docker compose up -d
> ```

**5. ì‹¤í–‰ ìƒíƒœ í™•ì¸ (Verify)**

ëª¨ë“  ì»¨í…Œì´ë„ˆê°€ `healthy` ë˜ëŠ” `Up` ìƒíƒœì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
> ```bash
> docker compose ps
> ```

**ì •ìƒ ê²°ê³¼ ì˜ˆì‹œ:**
> ```
> aegis-agent           ......     Up 1 minutes (healthy)
> aegis-db              ......     Up 1 minutes (healthy)
> aegis-log-rotator     ......     Up 1 minutes
> aegis-npm             ......     Up 1 minutes (healthy)
> ```

**Note:** ì´ˆê¸° ì‹¤í–‰ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ë° WAF ì—”ì§„ ì´ˆê¸°í™”ë¡œ ì¸í•´ `aegis-npm` ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ê¸°ê¹Œì§€ ì•½ 1~2ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âš ï¸ Known Issues & Workarounds (ì•Œë ¤ì§„ ì´ìŠˆ ë° í•´ê²° ë°©ë²•)

### 1. SSL ì¸ì¦ì„œ ë°œê¸‰ ì‹œ "Test Reachability" ì‹¤íŒ¨ í˜„ìƒ
NPM UIì—ì„œ SSL ì¸ì¦ì„œ ë°œê¸‰ ì‹œ `JSONObject["responsetime"] not found` ë˜ëŠ” `Unexpected status code` ì˜¤ë¥˜ì™€ í•¨ê»˜ ë„ë©”ì¸ ì—°ê²° í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.

> * **ì›ì¸:** ì´ëŠ” Aegis-Proxy-Stackì˜ ê²°í•¨ì´ ì•„ë‹Œ, **Nginx Proxy Manager(NPM) ìì²´ì˜ ê³ ì§ˆì ì¸ ì‚¬ì „ ì ê²€ ë¡œì§ ì´ìŠˆ**ì…ë‹ˆë‹¤. NPM ë°±ì—”ë“œê°€ ìê¸° ìì‹ ì˜ ê³µì¸ IPë¡œ ì ‘ì†í•˜ì—¬ ì‘ë‹µì„ í™•ì¸í•˜ëŠ” ê³¼ì •ì—ì„œ ë£¨í”„ë°±(Loopback) ê²½ë¡œ ë¬¸ì œë‚˜ ë³´ì•ˆ ëª¨ë“ˆì˜ ì‘ë‹µ í—¤ë” ê°„ì„­ìœ¼ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤.
> * **ì¦ìƒ:** "Test Reachability" ë²„íŠ¼ í´ë¦­ ì‹œ ì—ëŸ¬ê°€ ë°œìƒí•˜ê±°ë‚˜, ì¸ì¦ì„œ ë°œê¸‰ ì°½ì—ì„œ ì €ì¥ ì‹œ ê²½ê³  íŒì—…ì´ ëœ¸.
> * **í•´ê²° ë°©ë²• (Workaround):**
>     1. **ë¬´ì‹œí•˜ê³  ì§„í–‰:** ì‚¬ì „ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì™€ ìƒê´€ì—†ì´ ì‹¤ì œ `Certbot`ì„ í†µí•œ ì¸ì¦ì„œ ë°œê¸‰ì€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤. ì—ëŸ¬ íŒì—…ì´ ëœ¨ë”ë¼ë„ ë‹¤ì‹œ í•œë²ˆ **Save**ë¥¼ ëˆ„ë¥´ë©´ ë°œê¸‰ì´ ì™„ë£Œë©ë‹ˆë‹¤.
>     2. **Temporary Disable:** ë§Œì•½ ì§€ì†ì ìœ¼ë¡œ ì‹¤íŒ¨í•œë‹¤ë©´, í•´ë‹¹ Proxy Hostë¥¼ ì ì‹œ **'Disabled'** ìƒíƒœë¡œ ë³€ê²½í•œ ë’¤ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ìœ¼ì„¸ìš”. ë°œê¸‰ ì„±ê³µ í›„ ë‹¤ì‹œ 'Enabled' ë° 'open-appsec ON'ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.

---

## âš™ï¸ Configuration & Usage

### 1. ê´€ë¦¬ì í˜ì´ì§€ ì ‘ì†
ë¸Œë¼ìš°ì €ë¥¼ ì—´ê³  ì„œë²„ì˜ 81ë²ˆ í¬íŠ¸ë¡œ ì•„ë˜ ê³„ì • ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ ì ‘ì†í•œ í›„ ê³„ì • ì •ë³´ë¥¼ ì›í•˜ëŠ” ì •ë³´ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
> * **URL:** `http://your-server-ip:81`
> * **Default Email:** `admin@example.com`
> * **Default Password:** `changeme`

âš ï¸ **ë³´ì•ˆ ê¶Œì¥ì‚¬í•­:** ë¡œê·¸ì¸ ì¦‰ì‹œ ê´€ë¦¬ì ê³„ì •ì˜ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹­ì‹œì˜¤.

### 2. WAF(open-appsec) í™œì„±í™” í™•ì¸
> 1. NGINX Proxy Manager ê´€ë¦¬ì í™”ë©´ì—ì„œ **Hosts** > **Proxy Hosts** > **Add Proxy Host** ë©”ë‰´ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
> 2. í˜¸ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ê¸°ì¡´ í˜¸ìŠ¤íŠ¸ë¥¼ í¸ì§‘í•©ë‹ˆë‹¤.
> 3. ì„¤ì • íŒì—…ì°½ì— **open-appsec** í•­ëª©ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
> 4. `open-appsec` í† ê¸€ ìŠ¤ìœ„ì¹˜ë¥¼ Onìœ¼ë¡œ ë³€ê²½í•˜ë©´ í•´ë‹¹ ë„ë©”ì¸ì— ëŒ€í•œ ê¸°ê³„ í•™ìŠµ ê¸°ë°˜ ë³´í˜¸ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.

### 3. ì£¼ìš” ë””ë ‰í† ë¦¬ êµ¬ì¡°
ì„¤ì¹˜ í›„ ìƒì„±ë˜ëŠ” ì£¼ìš” ë°ì´í„° í´ë”ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
> * `data/`: NPM ì„¤ì • ë° ì›¹ ì„œë²„ ë°ì´í„° (Proxy Host ì„¤ì •, ì‚¬ìš©ì ê³„ì • ì •ë³´ ë“±)
> * `db/`: MariaDB ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ (NPMì˜ ëª¨ë“  ë©”íƒ€ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” ì‹¤ì œ DB íŒŒì¼)
> * `db-init/`: DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ (ì»¨í…Œì´ë„ˆ ìµœì´ˆ ìƒì„± ì‹œ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„±í•˜ëŠ” SQL íŒŒì¼)
> * `letsencrypt/`: TLS ì¸ì¦ì„œ ì €ì¥ì†Œ (Let's Encryptì—ì„œ ë°œê¸‰ë°›ì€ ì‹¤ì œ ì¸ì¦ì„œ ë° í‚¤ íŒŒì¼)
> * `logrotate/`: ë¡œê·¸ ìˆœí™˜ ì„¤ì • (ë³´ì•ˆ ê·œì œ ì¤€ìˆ˜ë¥¼ ìœ„í•œ ë¡œê·¸ ë³´ê´€ ì£¼ê¸° ë° ì••ì¶• ì„¤ì • íŒŒì¼)
> * `waf-config/`: WAF ì—ì´ì „íŠ¸ ì„¤ì • (í´ë¼ìš°ë“œ ë™ê¸°í™” ì •ë³´ ë° ì—ì´ì „íŠ¸ ê³ ìœ  ì„¤ì • íŒŒì¼ ì €ì¥)
> * `waf-data/`: WAF í•™ìŠµ ë°ì´í„° (ê¸°ê³„ í•™ìŠµ ëª¨ë¸ì˜ íƒì§€ ì •í™•ë„ í–¥ìƒì„ ìœ„í•œ ì˜ì†ì„± ë°ì´í„° ì €ì¥)
> * `waf-logs/`: ë³´ì•ˆ ì°¨ë‹¨ ìƒì„¸ ë¡œê·¸ (WAFì— ì˜í•´ ì°¨ë‹¨ëœ ê³µê²© ì´ë²¤íŠ¸ ë¡œê·¸ - waf_security_log.log)
> * `waf-share/`: ì •ì±… ê³µìœ  ë””ë ‰í† ë¦¬ (NPM UIì—ì„œ ì„¤ì •í•œ ì •ì±…ì„ WAF ì—”ì§„ì´ ì½ì–´ê°€ëŠ” êµí™˜ êµ¬ì—­)

---

## ğŸ§ª Verification & Testing (ê²€ì¦ ë° í…ŒìŠ¤íŠ¸)

ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ë‹¤ìŒ ë‹¨ê³„ì— ë”°ë¼ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.

### 1. WAF ë™ì‘ í…ŒìŠ¤íŠ¸ (Attack Simulation)
ê°€ì¥ ì¤‘ìš”í•œ ë‹¨ê³„ì…ë‹ˆë‹¤. ì‹¤ì œë¡œ ì›¹ ê³µê²© íŒ¨í„´ì„ ì „ì†¡í•˜ì—¬ WAFê°€ ì´ë¥¼ ì°¨ë‹¨í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

**Step 1. í…ŒìŠ¤íŠ¸ìš© í˜¸ìŠ¤íŠ¸ ìƒì„±**

> 1. NGINX Proxy Manager ê´€ë¦¬ì í˜ì´ì§€(`http://ì„œë²„IP:81`)ì— ë¡œê·¸ì¸í•©ë‹ˆë‹¤.
> 2. **Hosts** > **Proxy Hosts** > **Add Proxy Host** ë©”ë‰´ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
> 3. **Details** íƒ­:
>     * Domain Names: `test.aegis.local` (ë˜ëŠ” ë³´ìœ í•œ ì‹¤ì œ ë„ë©”ì¸)
>     * Forward Hostname / IP: `127.0.0.1` (ë˜ëŠ” ì•„ë¬´ ì›¹ì„œë²„ IP)
>     * Forward Port: `80`
> 4. **open-appsec** (ì¤‘ìš”):
>     * **í† ê¸€ ìŠ¤ìœ„ì¹˜ On** ì²´í¬ âœ…
> 5. ì €ì¥í•©ë‹ˆë‹¤.

**Step 2. ê³µê²© ì‹œë®¬ë ˆì´ì…˜ (SQL Injection / XSS)**
í„°ë¯¸ë„ì—ì„œ `curl` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µê²© íŒ¨í„´ì´ í¬í•¨ëœ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
*(ë„ë©”ì¸ì„ ì‹¤ì œ ë“±ë¡í•˜ì§€ ì•Šì•˜ë‹¤ë©´ `-H "Host: ..."` ì˜µì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤)*
> 1. ì •ìƒ ìš”ì²­ (í†µê³¼ë˜ì–´ì•¼ í•¨)
> ê²°ê³¼: HTTP/1.1 200 OK (ë˜ëŠ” 302/404 ë“± ì›¹ì„œë²„ ì‘ë‹µ)
> ```bash
> curl -I -H "Host: test.aegis.local" http://127.0.0.1/
> ```
> 
> 2. SQL Injection ê³µê²© ì‹œë„ (ì°¨ë‹¨ë˜ì–´ì•¼ í•¨)
> ê²°ê³¼: HTTP/1.1 403 Forbidden
> ```bash
> curl -I -H "Host: test.aegis.local" "http://127.0.0.1/?id=1' OR '1'='1"
> ```
> 
> 3. XSS ê³µê²© ì‹œë„ (ì°¨ë‹¨ë˜ì–´ì•¼ í•¨)
> ê²°ê³¼: HTTP/1.1 403 Forbidden
> ```bash
> curl -I -H "Host: test.aegis.local" "http://127.0.0.1/?search=<script>alert(1)</script>"
> ```

**ğŸ‰ ì„±ê³µ íŒì •:** ê³µê²© íŒ¨í„´ì´ í¬í•¨ëœ ìš”ì²­ì— ëŒ€í•´ **`403 Forbidden`** ì‘ë‹µì´ ì˜¨ë‹¤ë©´ WAFê°€ ì •ìƒì ìœ¼ë¡œ ê³µê²©ì„ ë°©ì–´í•˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

### 2. ë¡œê·¸ í™•ì¸ (Log Check)
ì°¨ë‹¨ëœ ê³µê²© ê¸°ë¡ì´ ë¡œê·¸ íŒŒì¼ì— ë‚¨ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
> * WAF ë³´ì•ˆ ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
> ```bash
> tail -f waf-logs/waf_security_log.log
> ```

ë¡œê·¸ íŒŒì¼ì— ë°©ê¸ˆ ì‹¤í–‰í•œ `curl` ëª…ë ¹ì˜ ì°¨ë‹¨ ë‚´ì—­(SQL Injection, XSS)ì´ JSON í˜•íƒœë¡œ ê¸°ë¡ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

---

## âš–ï¸ License

ë³¸ í”„ë¡œì íŠ¸ëŠ” ì—¬ëŸ¬ ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¥¼ í†µí•©í•œ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ê° êµ¬ì„± ìš”ì†Œì˜ ë¼ì´ì„ ìŠ¤ë¥¼ ì¤€ìˆ˜í•©ë‹ˆë‹¤.

* **Aegis-Proxy-Stack Configuration:** MIT License
* **open-appsec:** Apache 2.0 (Engine) / Machine Learning Model License (Advanced Model)
* **NGINX Proxy Manager:** MIT License
* **CrowdSec:** MIT License
* **GoAccess:** MIT License